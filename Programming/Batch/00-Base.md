# Batch

Batch - язык используемый windows для bat файлов

# Начальная настройка консоли

Начальная настройка:

-   [Отключаем засирание консоли](#console---disable-log)
-   [Подключаем русские символы](#console---русские-символы)
-   [Меняем заголовок консоли](#console---tittle)
-   [Меняем цвет текста/фона консоли](#console---color)

# Console

## Вывод в консоль

Вывод в консоль:

-   [echo - выводим в консоль](#console---echo)
-   [echo - выводим пустую строку](#console---new-line)

Ввод в консоль:

-   [Считать значение переменной из консоли](#variable---прочитать-переменную-из-консоли)

Логика потоков в windows работает примерно как в Linux:

-   [Перенаправляем поток в файл](#stream---write)
-   [Перенаправляем поток в никуда](#stream---null)

## Жизненный цикл консоли

Управление жизненным циклом консоли:

-   [Pause - остановка работы до ввода символа](#console---pause)
-   [Exit - прекращение работы](#console---exit)

# Syntax

Базовые синтаксические конструкции

## Комментарии

Комментарии:

-   [Основной способ оставлять комментарии](#syntax---comment)
-   [Вспомогательный способ осталять комментарии](#syntax---comment2)

## Условия

Условия - классика, if/else:

-   [ERRORLEVEL - ошибка прошлой комманды](#syntax---errorlevel)
-   [if/else - пример](#syntax---condition)
-   [Операторы сравнения внутри условий](#syntax---операторы)

## Goto

Goto - по сути прыжок к метке, но можно и создавать что-то вроде методов:

-   [Пример бесконечного цикла из метки и goto](#goto---бесконечный-цикл)
-   [Пример метода](#goto---метод)

## Переменные

Переменные внутри bat скрипта:

-   [Создание и использование переменной](#variable---создаем-переменную)
-   [Использование переменной как макрос](#variable---используем-переменные-как-макрос)
-   [Считать значение переменной из консоли](#variable---прочитать-переменную-из-консоли)

Записать/считать переменные из файла:

-   [Записываем список всех доступных переменных в файл](#variable---записать-переменные)
-   [Считываем переменные из файла](#variable---считать-переменные)

Задать Environment variable:

-   [Задаем environment переменные в windows](#variable---environment-variable)

# Примеры

## Variable - Записать переменные

Список всех доступных переменных можно записать в файл:

```bat
set > env-var
```

## Variable - Считать переменные

Получить переменные из файла:

-   env-var.txt - файл из которого вытаскиваем переменные

```bat
for /f "delims== tokens=1,2" %%G in (env-var.txt) do set %%G=%%H
```

Пример файла env-var.txt:

-   использование равно внутри переменной, заканчиавает переменную

```txt
PARAM1=value1 it's value
PARAM2=value2
```

## Variable - Создаем переменную

Создаем переменную переменную внутри bat скрипта:

```bat
set test="\wamp\bin\php\php5.4.16"
echo %test%
:: => "\wamp\bin\php\php5.4.16"

set test2=a=2+2
echo %test2%
:: => a=2+2

set /a test3=2+2
echo %test3%
:: => 4
```

## Variable - Используем переменные как макрос

Переменные в batch, ближе к макросам, и по сути значение переменной подставляется прямо в скрипт:

-   в примере, произойдет создание метки в runtime
    -   если var_project=1
    -   если var_todo=2
    -   имя вызванной метки будет run_1_2
-   goto run*%var_project%*%var_todo%
    -   goto - перемеходим к метке с именем
    -   run*%var_project%*%var_todo% - имя метки, которое собирется на ходу
        -   %var_project% - сюда подставится переменная var_project
        -   %var_todo% - сюда подставится переменная var_todo

```bat
goto run_%var_project%_%var_todo%
```

## Variable - Прочитать переменную из консоли

Прочитать переменную из консоли:

-   /p - флаг запроса значения
-   a - имя переменной
-   Enter str - выводимая строка

```bat
set /p a=Enter str
```

## Variable - Environment Variable

[Environment Virable](../../Windows/02-Base.md#environment-variable) - можно задать через консоль:

-   Задаем User Variable

```bat
setx VAR_NAME value
```

-   Задаем System Variable:

```bat
setx VAR_NAME value /m
```

## Syntax - Errorlevel

Возможно предыдущая команда закончила работать с ошибкой, тогда обрабатываем по другому:

-   например find может бросить ошибку если ничего не нашел

```bat
if not %ERRORLEVEL% equ 1 (
    echo ok
) else (
    echo error
)
```

То же самое, но написано немного по другому:

```bat
if "%ERRORLEVEL%"=="0" (
    echo ok
) else (
    echo error
)
```

## Syntax - Condition

Пример if:

```bat
if not errorlevel equ 1 goto end
```

Пример if/else:

```bat
if "%ERRORLEVEL%"=="0" (
    echo STATE: %exe_name% запущен
) else (
    call :runexe_nginx
)
```

## Syntax - Операторы

Операторы:

| Оператор | Описание         |
| :------- | :--------------- |
| EQU      | равно            |
| NEQ      | не равно         |
| LSS      | меньше           |
| LEQ      | меньше или равно |
| GTR      | больше           |
| GEQ      | больше или равно |

Пример использования:

```bat
if not errorlevel equ 1 goto end
```

## Syntax - Comment

Comment - оставляем комментарий:

-   основной способ оставлять комментрии
-   по сути вызваем метод, который ничего не делает

```bat
rem комментарий тут, что ты ему сделаешь?
@REM комментарий тут, что ты ему сделаешь?
```

## Syntax - Comment#2

Comment - оставляем комментарий:

-   почему-то его не используют

```bat
:: echo 0) Выход
```

## Goto - Метод

Метод - goto можно использовать как метод и еще какие-то значения прокинуть:

-   call :method "МЕТОД ВЫЗВАН!!!"
    -   :method - метка которую вызваем
    -   "МЕТОД ВЫЗВАН!!!" - значение которое передаем, можно передать несколько
-   echo "%~1" - выводим первое переданное в метод значение
-   goto :eof - вернет обратно в точку вызова

```bat
call :method "МЕТОД ВЫЗВАН!!!"
exit

:method
echo "%~1"
goto :eof
```

## Goto - Бесконечный цикл

Делаем бесконечный цикл:

-   :m - метка
-   goto m - переходим к метке m

```bat
:m
goto m
```

## Console - Pause

Pause - пауза, остановка работы программы до введения любого символа:

```bat
pause
```

## Console - Exit

Exit - прекращение работы batch файла:

```bat
exit
```

## Console - Color

Color - меняет цвет текста/консоли:

-   9b - шестнадцатиричное значение, указывающая цвет
    -   первый символ - фон
    -   вторый символ - текст

```bat
color 9b
```

<img src="./source/03-Host.png" style="display: block; height: 300px; margin: auto;"/>

## Console - Tittle

Поменять заголок окна:

```bat
title Новый заголовок
```

## Stream - Write

Запись(перезапись) в файл:

```bat
echo Test > file.txt
```

Запись(добавление) в файл:

```bat
echo Test2 >> file.txt
```

## Stream - Null

## Console - echo

echo - команда вывода в консоль:

```bat
echo 0) Выход
:: => 0) Выход
```

## Console - New line

New line - для вывода пустой строки используй:

```bat
echo[
echo 0) Выход
:: =>
:: => 0) Выход
```

## Console - Disable log

Disable log - отключаем логи(в каком-то смсле), любая команда срет в консоль, чтобы этого не происходило используй в начале:

```bat
@echo off
```

## Console - Русские символы

Русские символы - как-то не работает batch с русскимим символами без вот этой штуки:

```bat
chcp 65001
```
