# PostgreSQL - Index

Index - PostgresSQL для оптимизации поиска, может создать дерево для таблицы, по которому поиск будет значительно быстрее

## Index - Зачем?

Для того, что не сканировать всю таблицу построчно, используется система индексов:

-   обычно заранее создается дерево, куда Postgres сортирует элементы
-   нельзя делать INSERT, UPDATE и DELETE при построении индексов
    -   сущесвует неблокирующее построение индексов, но там много оговорок

## Index - Type

Поддерживаемые типы индексов:

-   [B-дерево](#index-type---b-дерево)
-   [Hash](#index-type---hash)
-   [GiST](#index-type---gist)
-   [GIN](#index-type---gin)
-   [SP-GiST](#index-type---sp-gist)
-   [BRIN](#index-type---brin)

## Index - специфичные вещи

Индексы с нестандартными правилами сортировки:

-   В зависимости от того, какие запросы будут чаще, можно настроить индексы для ускорения сортировки. Чистая оптимизация:
-   [Кури документацияю](https://postgrespro.ru/docs/postgresql/9.6/indexes-ordering)

Объединение индексов:

-   Можно создать несколько индексов и объеденить их. Тогда запросы по двум столбцам сразу, станут эффективне, но запросы по одному столбцу, менее эффективными:
-   [Кури документацияю](https://postgrespro.ru/docs/postgresql/9.6/indexes-bitmap-scans)

Уникальные индексы:

-   Индексы могут обеспечить уникальность строк. Зачем это нужно? Я не знаю:
-   [Кури документацияю](https://postgrespro.ru/docs/postgresql/9.6/indexes-unique)

# Примеры

## Index Type - B-дерево

B-дерево - индекс по классическому, жесткосбалансированному дереву:

-   способ индексации по умолчанию
-   классическое бинарное дерево
-   работает при сравнениях, поисках в начале строки, is null, is not null и т.д.

```ddl
-- Создаем INDEX типа B-дерево
CREATE INDEX имя ON таблица (столбец1, столбец2);
```

## Index Type - Hash

Hash:

-   работает только при сравнении на равенство
-   рекомендуется не использовать их, так как часто ломаются и REINDEX не помогает

```ddl
-- Создаем INDEX типа HASH
CREATE INDEX имя ON таблица USING HASH (столбец);
```

## Index Type - GiST

GiST:

-   нужен для индексации по объектам в пространстве
-   R-дерево с фишками быстрого поиска по нему
-   меньше GIN по размерам в 3 раза, но медленнее в 3 раза

## Index Type - GIN

GIN:

-   нужен для индексации по объектам в пространстве
-   больше GIN по размерам в 3 раза, но быстрее в 3 раза

## Index Type - SP-GiST

SP-GiST:

-   не сбалансированное дерево
-   разбивает пространство на непересекающиеся квадранты

## Index Type - BRIN

BRIN:

-   сортровка связаны с физическим расположением строк в таблице
-   разбивает таблицу на блоки, и знает в каких блоках максимальное и минимальное значение
-   очень небольшой по размеру
-   используется с логами или историями покупок(потому что забиси разбиты по дате)
